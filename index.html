const namesList = ["Jawwad", "Imran", "Abdiya", "Farhan"];
const months = ["February", "March", "April", "May", "June", "July", "August", "September", "October"];

let monthIndex = 0;

// Track how many times each person has been picked
let pickCounts = {};
namesList.forEach(name => pickCounts[name] = 0);

function pickChit() {
  if (monthIndex >= months.length) {
    const resultDiv = document.getElementById("result");
    resultDiv.innerText = "All chits have been picked!";
    resultDiv.classList.add("show");
    return;
  }

  // Filter names that still have remaining chits (max 3 per person)
  const availableNames = namesList.filter(name => pickCounts[name] < 3);
  if (availableNames.length === 0) {
    const resultDiv = document.getElementById("result");
    resultDiv.innerText = "All chits have been picked!";
    resultDiv.classList.add("show");
    return;
  }

  // Pick random name from available
  const index = Math.floor(Math.random() * availableNames.length);
  const picked = availableNames[index];

  // Increment count
  pickCounts[picked]++;

  // Format as 1st, 2nd, 3rd
  const suffix = pickCounts[picked] === 1 ? "1st" :
                 pickCounts[picked] === 2 ? "2nd" : "3rd";

  const currentMonth = months[monthIndex];

  // Show picked result
  const resultDiv = document.getElementById("result");
  resultDiv.innerText = `${currentMonth}: ${picked} (${suffix}) gets $9,000`;
  resultDiv.classList.remove("show");
  void resultDiv.offsetWidth;
  resultDiv.classList.add("show");

  // Add to history
  const historyList = document.getElementById("history");
  const li = document.createElement("li");
  li.innerText = `${currentMonth}: ${picked} (${suffix})`;
  historyList.appendChild(li);

  // Confetti animation
  confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

  monthIndex++;
}

function resetPicker() {
  monthIndex = 0;
  document.getElementById("history").innerHTML = "";
  const resultDiv = document.getElementById("result");
  resultDiv.innerText = "";
  resultDiv.classList.remove("show");
  // Reset pick counts
  namesList.forEach(name => pickCounts[name] = 0);
}
